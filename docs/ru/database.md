# База данных

## Выбор базы данных

По умолчанию приложение использует **SQLite** в качестве базы данных. Это простая и легковесная база данных, которая хранится в виде одного файла. Она хорошо подходит для работы в монопольном режиме одного пользователя, что делает ее идеальным выбором для данного приложения.

В будущем планируется добави��ь поддержку и более серьезных баз данных, таких как **PostgreSQL** или других.

## ORM

Для взаимодействия с базой данных приложение использует **SQLAlchemy** Object-Relational Mapper (ORM). Это позволяет использовать высокоуровневый, объектно-ориентированный подход к операциям с базой данных и облегчает поддержку различных систем баз данных в будущем.

## Содержимое базы данных

База данных хранит два основных типа информации:
1.  Текущую конфигурацию приложения.
2.  Историю чата пользователя, включая запросы и соответствующие ответы от языковой модели.

### Структура таблицы

Основная таблица для хранения истории чата называется `chat`. Она имеет следующую структуру:

| Колонка    | Тип       | Описание                                              |
|------------|-----------|-------------------------------------------------------|
| `id`       | Integer   | Уникальный идентификатор сообщения.                   |
| `role`     | String    | Роль автора сообщения (например, `user`, `model`).    |
| `original` | String    | Текст сообщения на исходном языке.                    |
| `english`  | String    | Английский перевод текста сообщения.                  |
| `parent_id`| Integer   | `id` предыдущего сообщения в диалоге.                 |
| `config`   | JSON      | Опции конфигурации модели для этого сообщения.        |

Связи `parent` и `children` управляются с помощью функциональности SQLAlchemy relationships, связывая сообщения в диалоговое дерево.

## Миграции

Приложение находится в активной фаз�� разработки, и структура базы данных может измениться. Для управления этими изменениями мы используем **Alembic** для миграций базы данных.

## Конфигурация

По умолчанию файл базы данных называется `chat.db` и находится в текущей рабочей директории. Вы можете изменить имя и расположение этого файла в конфигурационном файле приложения.
