# Справка по Chat CLI

Это интерфейс командной строки для взаимодействия с языковыми моделями Groq.

## Использование

```bash
chat <команда> [аргументы]
```

## Команды

### `new`

Создает новую сессию чата и структуру проекта.

**Использование:**

```bash
chat new <имя_проекта> [--lang <язык>] [--readme] [--license <тип_лицензии>]
```

**Описание:**

Эта команда создает новую папку с указанным `<имя_проекта>` и инициализирует в ней структуру проекта для нового чата.

**Структура проекта:**

*   **`<имя_проекта>/`**
    *   **`config.json`**: Файл конфигурации с настройками по умолчанию.
    *   **`chat.db`**: Файл базы данных, в который записываются все промпты пользователя и ответы нейросети для ведения истории диалога.
    *   **`<имя_проекта>/`**: Папка с исходным кодом проекта.
        *   В этой папке инициализируется репозиторий Git (`git init`).
        *   Содержимое папки зависит от выбранного языка программирования.

**Аргументы:**

*   `<имя_проекта>` (обязательный): Имя для новой папки проекта.

**Опции:**

*   `--lang <я��ык>` (опционально): Задает язык программирования для создания типовой структуры проекта. Например, `python`, `javascript`.
*   `--readme` (опционально): Создает файл `README.md` в папке с исходным кодом с заголовком, соответствующим имени проекта.
*   `--license <тип_лицензии>` (опционально): Создает файл лицензии в папке с исходным кодом. Например, `MIT`, `GPL-3.0`.

### `add`

Добавляет промпт пользователя в чат, получает ответ от модели и сохраняет переписку в базе данных.

**Использование:**

```bash
chat add
```

**Описание:**

Эта команда запускает последовательность действий для продолжения диалога:

1.  **Ввод пользователя**: Пользователю предлагается ввести свое сообщение.
2.  **Сохранение промпта**: Сообщение сохраняется как новая запись в `chat.db` с уникальным `id`, текстом в поле `original` и `id` родительского сообщения.
3.  **Перевод промпта**: Сообще��ие переводится на английский язык, и обновляется поле `english`.
4.  **Получение ответа на родном языке**: Полная история диалога (на исходном языке) отправляется модели.
5.  **Сохранение ответа на родном языке**: Ответ модели сохраняется как новая запись, связанная с промптом пользователя через поле `parent`.
6.  **Получение ответа на английском языке**: Английская история диалога отправляется модели, и полученный ответ сохраняется в поле `english` новой записи.
7.  **Обновление состояния**: Запись с ответом становится новым "текущим" сообщением.

**Обработка ошибок:**

*   Приложение завершится с ошибкой (например, "Ошибка записи в базу данных"), если не удастся ��ыполнить запись в БД.
*   Приложение завершится, если не удастся получить ответ от модели во время перевода или генерации ответа.

**Визуализация связи в БД:**

```
   Запись пользователя              Запись ответа модели
   ┌──────────────────────────┐       ┌───────────────────────────┐
   │ id: 10                   │       │ id: 11                    │
   │ original: "Как дела?"    │       │ original: "У меня все..." │
   │ english: "How are you?"  │       │ english: "I'm doing..."   │
   │ parent: 9                │       │ parent: 10                │
   │ children: [11]           ├──────►│ children: NULL            │
   └──────────────────────────┘       └───────────────────────────┘
```

**Колонки базы данных:**

*   `id`: Уникальный идентификатор.
*   `original`: Текст на исходном языке.
*   `english`: Перевод текста на английский язык.
*   `parent`: `id` предыдущей записи.
*   `children`: Список `id` последующих записей.

### `switch`

Изменяет текущее сообщение (HEAD) на другое сообщение в истории чата.

**Использование:**

```bash
chat switch <id_сообщения>
```

**Описание:**

Эта команда позволяет изменить текущий контекст диалога на любое сообщение в истории, указав его ID. Последующие команды, такие как `chat add`, будут считать новое сообщение родительским, что позволяет создавать ветвления в диалоге с более ранней точки.

**Аргументы:**

*   `<id_сообщения>` (обязательный): Идентификатор сообщения, которое нужно установить как новое текущее сообщение (HEAD).

### `log`

Показывает узлы дерева диалога.

**Использование:** `log [<число>] [--show-text <режим>] [--lang <язык>]`

**Аргументы:**
*   `<число>`: (Опционально) Если задано, выводит число узлов текущей ветки диалога, не превышающее указанное. По умолчанию выводится всё дерево диалога.

**Опции:**
*   `--graph`: (Опционально) Отображает дерево чата в виде графа.
*   `--show-text <режим>`: (Опционально) Определяет, отображать ли текст сообщения и как именно. Если опция не указана, текст не показывается.
    *   `all`: Показывать текст сообщения для каждого узла.
    *   `leaves`: Показывать текст сообщения только для конечных узлов ветки.
*   `--lang <язык>`: (Опционально) Устанавливает язык для о��ображения сообщений. Опция действует только при использовании `--show-text`. По умолчанию используется `both`.
    *   `origin`: Показывать сообщения только на родном языке.
    *   `english`: Показывать сообщения только на английском языке.
    *   `both`: Показывать текст сообщения на обоих языках для каждого узла (по умолчанию).

### `edit`

Редактирует текст указанного сообщения с автоматическим переводом для поддержания консистентности между оригинальной и английской версиями.

**Использование:**

```bash
chat edit [<id>] [--original] [--english]
```

**Описание:**

Эта команда открывает текст сообщения в терминальном редакторе. Если `id` не указан, команда применяется к текущему сообщению (HEAD).

Для поддержания консистентности команда автоматически синхронизирует текстовые поля `original` и `english`. Редактирование одного поля запускает автоматический перевод для обновления другого.

*   **Редактирование оригинального текста (по умолчанию)**: Отредактированный текст сохраняется, а затем автоматически переводится для обновления поля `english`.
*   **Редактирование текста на английском языке (`--english`)**: Отредактированный текст сохраняется, а затем автоматически переводится на исходный язык для обновления поля `original`.

**Пример работы для `chat edit 10 --english`:**

1.  Извлекается текст из поля `english` сообщения с `id` 10.
2.  Текст открывается в терм��нальном редакторе для изменения.
3.  Отредактированный текст отправляется в сервис перевода для перевода на исходный язык.
4.  Отредактированный текст сохраняется в поле `english`.
5.  Переведенный текст сохраняется в поле `original`.

**Аргументы:**

*   `<id>` (опционально): Идентификатор сообщения для редактирования. Если не указан, используется текущее сообщение.

**Опции:**

*   `--original`: Явно указывает, что нужно редактировать текстовое поле `original`. Это поведение по умолчанию.
*   `--english`: Указывает, что нужно редактировать текстовое поле `english`.

**Обработка ошибок:**

*   Приложение завершится с ошибкой "Ошибка доступа к базе данных", если не удастся вы��олнить запись в БД.
*   Приложение завершится с ошибкой "Сервис не отвечает", если не удастся получить ответ от сервиса перевода.
